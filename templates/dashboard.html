{% extends "base.html" %}
{% block content %}
<div class="row mb-4">
  <div class="col-md-8">
    <h2>Dashboard</h2>
    <p class="text-muted">Bem-vindo, <strong>{{ session.get('username') }}</strong></p>
  </div>
  <div class="col-md-4 text-end">
    <a class="btn btn-outline-secondary" href="/logout">Sair</a>
  </div>
</div>

<div class="row g-3">

  <!-- CARD TOTAL DE USUÃRIOS -->
  <div class="col-md-4">
    <div class="card card-stats p-3 shadow-sm">
      <h5>Total de usuÃ¡rios</h5>
      <h2>{{ total_users }}</h2>
    </div>
  </div>

  <!-- CARD SESSÃ•ES ATIVAS -->
  <div class="col-md-4">
    <div class="card card-stats p-3 shadow-sm">
      <h5>SessÃµes ativas</h5>
      <h2>{{ active_sessions }}</h2>
    </div>
  </div>

  <!-- CARD ÃšLTIMOS LOGINS -->
  <div class="col-md-4">
    <div class="card card-stats p-3 shadow-sm">
      <h5>Ãšltimos logins</h5>
      <ul class="list-unstyled mb-0">
        {% for u, info in recent %}
        <li>{{ u }} â€” {{ info.last_login|shorttime }}</li>
        {% else %}
        <li>Nenhum login recente</li>
        {% endfor %}
      </ul>
    </div>
  </div>

</div>

<!-- NOVA LINHA COM O CARD DO MQ-2 -->
<div class="row g-3 mt-3">

  <div class="col-md-4">
    <a href="{{ url_for('mq2_page') }}">
      <div class="card card-stats p-3 shadow-sm" style="cursor:pointer;">
        <h5>MQ-2 â€“ Monitoramento</h5>
        <h2 style="font-size:1.6rem;">ðŸ“¡ Ver Dashboard</h2>
        <p class="text-muted" style="margin:0;">Acompanhar leitura do sensor em tempo real</p>
      </div>
    </a>
  </div>

</div>

<!-- TABELA DE USUÃRIOS -->
<div class="row mt-4">
  <div class="col-12">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5>UsuÃ¡rios cadastrados</h5>
        <table class="table table-users table-striped mt-3">
          <thead>
            <tr>
              <th>UsuÃ¡rio</th>
              <th>Registrado em</th>
              <th>Ãšltimo login</th>
              <th>Logins</th>
              <th>Ativo</th>
            </tr>
          </thead>
          <tbody>
            {% for uname, info in users.items() %}
            <tr>
              <td>{{ uname }}</td>
              <td>{{ info.registered_at|shorttime }}</td>
              <td>{{ info.last_login|shorttime }}</td>
              <td>{{ info.login_count }}</td>
              <td>{% if info.logged_in %}âœ…{% else %}â€”{% endif %}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

{% endblock %}
